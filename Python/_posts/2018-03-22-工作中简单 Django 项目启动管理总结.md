---
layout: right-sidebar
title: 工作中简单 Django 项目启动管理总结
---

创建项目目录：

    $ mkdir PROJECT_NAME

进入 PROJECT_NAME 目录：

    $ cd PROJECT_NAME/

创建 Django 项目：

    $ django-admin startproject PROJECT_NAME
    $ ls
    PROJECT_NAME

将 PROJECT_NAME 目录重命名为 src：

    $ mv PROJECT_NAME src
    $ ls
    src

创建 Python 虚拟环境：

    $ virtualenv venv
    $ ls
    src  venv

加载 Python 虚拟环境：

    $ source venv/bin/activate
    或
    $ . venv/bin/activate

在 Python 虚拟环境中安装 Django：

    $ pip install Django==1.11.11
     或利用国内源
    $ pip install Django==1.11.11 -i https://pypi.tuna.tsinghua.edu.cn/simple

进入 src 目录：

    $ cd src/

将 Python 依赖包冻结到 requirements.txt 文件，此文件跟随版本库。

    $ pip freeze > requirements.txt

创建 Django app：

    $ python manage.py startapp APP_NAME

此刻 PROJECT_NAME 文件夹内的目录结构为：

    --- PROJECT_NAME/
        --- src/
            --- APP_NAME/
            --- PROJECT_NAME/
            --- manage.py
            --- requirements.txt
        --- venv/
            --- 省略

创建开发阶段使用的重置脚本：

    $ vi reset.sh

    #!/bin/sh

    # 删除所有 migrations 目录下的迁移文件。
    find . -path "*/migrations/*" -not -name "__init__.py" -delete &&

    # 删除数据库文件。
    find . -name "db.sqlite3" -delete &&

    # 删除 media 和 static 目录。
    rm -rf media static &&

    # 生成 migration 文件。
    python manage.py makemigrations &&

    # 向数据库写入表结构。
    python manage.py migrate &&
    # python manage.py migrate --database=DB_NAME &&
    
    # 创建超级管理员。
    echo "\
    from django.contrib.auth.models import User;\
    User.objects.create_superuser('admin', 'admin@example.com', 'password');\
    " | python manage.py shell &&

    # 运行开发 web 服务器。
    python manage.py runserver

给重置脚本增加可执行权限：

    $ chmod u+x reset.sh

创建 .gitignore 文件：

    $ vi .gitignore

    # 忽略 macOS 的 .DS_Store 文件。
    .DS_Store

    # 忽略 IDE 的项目配置文件。
    .idea/

    # 忽略数据库文件
    /db.sqlite3

    # 忽略 static 和 media 目录。
    /static/
    /media/

    # 忽略编译生成的字节码文件。
    *.pyc

    # 忽略各个 app 下 migrations 目录中的迁移文件，迁移文件的名字均以 0 开头。
    0*.py

创建 Git 仓库：

    $ git init

提交首次 commit：

    $ git add . && git commit -m 'init'

启动 web 服务器：

    $ ./reset.sh

此刻 PROJECT_NAME 文件夹内的目录结构为：

    --- PROJECT_NAME/
        --- src/
            --- .git/
            --- .gitignore
            --- APP_NAME/
            --- PROJECT_NAME/
            --- db.sqlite3
            --- manage.py
            --- requirements.txt
            --- reset.sh
        --- venv/
            --- 省略

settings.py 基础配置：

    ALLOWED_HOSTS = ['*']
    LANGUAGE_CODE = 'zh-Hans'
    TIME_ZONE = 'Asia/Shanghai'
    STATIC_URL = '/static/'
    STATIC_ROOT = os.path.join(BASE_DIR, 'static')
    MEDIA_URL = '/media/'
    MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

常用模块：

    from __future__ import unicode_literals
    from __future__ import division
    from django.utils.translation import ugettext_lazy as _
    from django.utils.encoding import python_2_unicode_compatible
    from django.contrib.auth.models import User
    from django.core.files import File
    from django.db import transaction
    from django.conf import settings

CodeSnippet

    #!/usr/bin/env python
    # -*- coding: utf-8 -*-

    admin.site.site_header = admin.site.site_title = _('')

    @python_2_unicode_compatible
    class Province(models.Model):
        def __str__(self):
            return self.pk
        class Meta:
            verbose_name = verbose_name_plural = _('')
        class Media():
        css = {
            'all': ('app/style.css',)
        }
        js = (app/script.js',)

